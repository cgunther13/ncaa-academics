---
title: "Taxi Outline"
author: "Christoph, Chris, Carol"
date: "4/19/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### 2015 Yellow Taxi Trip Data - NYC Open Data
https://data.cityofnewyork.us/Transportation/2015-Yellow-Taxi-Trip-Data/ba8s-jw6u

```{r}
taxi <- read.csv("taxi_data.csv", as.is = TRUE)
```

```{r}
library(dplyr)
library(ggplot2)
library(leaps)
library(lubridate)
library(ggmap)
library(mapproj)
```

### Research Questions
We are particularly interested in exploring 3 features of this taxi trips 
dataset: time (`dropoff_datetime` and `pickup_datetime`), location 
(`dropoff_latitude`, `dropoff_longitude`, `pickup_latitude`, and
`pickup_longitude`), and payments, specifically tips (`tip_amount`). 

## What factors predict how much (as a percentage of their total fare) a person tips?

```{r}
taxi <- taxi %>% mutate(tip_pct = (tip_amount / fare_amount) * 100)
taxi <- taxi[-c(which(taxi$tip_pct == "NaN"), which(taxi$tip_pct == "Inf")),]
taxi <- taxi[taxi$tip_pct <= 100,]
```

* Do people tip more if there are more passengers in the car (social pressure)? 

```{r}
taxi <- taxi[taxi$passenger_count > 0,]
ggplot(taxi, aes(x = as.factor(passenger_count), y = tip_pct)) + 
  geom_boxplot() +
  labs(title = "Percentage Tipped by Number of Passengers", x = 
    "Number of Passengers", y = "Percentage Tipped")
```

* Do people tip more if they get to where they are going more quickly?

```{r}
taxi$pickup_datetime <- ymd_hms(taxi$pickup_datetime)
taxi$dropoff_datetime <- ymd_hms(taxi$dropoff_datetime)
taxi$trip_duration <- as.numeric((taxi$dropoff_datetime - taxi$pickup_datetime) / 3600)
taxi$trip_duration[taxi$trip_duration == 0] <- NA
taxi$avg_speed <- taxi$trip_distance / taxi$trip_duration
taxi$avg_speed[taxi$avg_speed > 60] <- NA
```

```{r}

```

```{r}
ggplot(taxi, aes(x = avg_speed, y = tip_pct)) + 
  geom_point() +
  labs(title = "Percentage Tipped by Average Speed", x = 
    "Average Speed (mph)", y = "Percentage Tipped")
```

    * All-subsets regression, as well as explore interaction effects.
    * Do tips change by location (ie: more tips in the financial)

## How do trips change with location and time of day?
    * What are the most popular pickup and drop off locations in New York? 
    * How does this change by time of day?
    * Are the most popular pickup locations also the most popular dropoff 
    locations?
      * For example, do people take more taxis to JFK than from JFK (based on 
      rate_code variable == 1) 
    * Barchart of number of pickups every hour at the 5 most popular locations.
    * What is the average speed of taxis depending on the time of day and region 
      of the city? 
    * Which directions are taxis traveling on average at different times of the 
    day? (net movement into the city in the morning and net movement out in the 
    evenings)
